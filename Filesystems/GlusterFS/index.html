
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Recueil de notes techniques">
      
      
      
      
        <link rel="canonical" href="https://sebastienpascalpoher.github.io/notes/Filesystems/GlusterFS/">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>GlusterFS - Notes techniques</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#glusterfs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://sebastienpascalpoher.github.io/notes" title="Notes techniques" class="md-header-nav__button md-logo" aria-label="Notes techniques">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Notes techniques
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              GlusterFS
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/sebastienpascalpoher/notes/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://sebastienpascalpoher.github.io/notes" title="Notes techniques" class="md-nav__button md-logo" aria-label="Notes techniques">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Notes techniques
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/sebastienpascalpoher/notes/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
      
      <label class="md-nav__link" for="nav-2">
        Desktop
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Desktop" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Desktop
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Desktop/Manage_Dotfiles_with_Git/" class="md-nav__link">
        Manage Dotfiles with Git
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Desktop/Pulseaudio%26Bluetooth/" class="md-nav__link">
        Pulseaudio&Bluetooth
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Desktop/Sync_Github_fork/" class="md-nav__link">
        Syncing a Github fork
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
      
      <label class="md-nav__link" for="nav-3">
        Divers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Divers" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Divers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Divers/mkdocs/" class="md-nav__link">
        MkDocs
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
      
      <label class="md-nav__link" for="nav-4">
        Docker
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Docker" data-md-level="1">
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Docker/Container_backup/" class="md-nav__link">
        Container backup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Docker/Databases_backup/" class="md-nav__link">
        Databases backup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Docker/General_use/" class="md-nav__link">
        General use
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Docker/Tips/" class="md-nav__link">
        General Docker Tips and issues solutions
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
      
      <label class="md-nav__link" for="nav-5">
        Filesystems
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Filesystems" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          Filesystems
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Filesystems_tricks/" class="md-nav__link">
        Step 1: Find inode number of any file using following command on terminal.
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          GlusterFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        GlusterFS
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#glusterfs" class="md-nav__link">
    GlusterFS
  </a>
  
    <nav class="md-nav" aria-label="GlusterFS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pour-quoi-faire" class="md-nav__link">
    Pour quoi faire ?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-volumes-glusterfs" class="md-nav__link">
    Les volumes GlusterFS
  </a>
  
    <nav class="md-nav" aria-label="Les volumes GlusterFS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#volume-distribue" class="md-nav__link">
    Volume distribué
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-replique" class="md-nav__link">
    Volume répliqué
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-distribue-replique" class="md-nav__link">
    Volume distribué répliqué
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lenvironnement" class="md-nav__link">
    L’environnement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-trusted-pool" class="md-nav__link">
    Le trusted pool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-volume-replique" class="md-nav__link">
    Un volume répliqué
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connexion-dun-client" class="md-nav__link">
    Connexion d’un client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-brin-de-securite" class="md-nav__link">
    Un brin de sécurité
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#une-corbeille-sur-le-volume" class="md-nav__link">
    Une corbeille sur le volume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-hs-pas-de-panique" class="md-nav__link">
    Node HS ? Pas de panique !
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etendre-le-volume" class="md-nav__link">
    Étendre le volume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-quotas" class="md-nav__link">
    Les quotas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../LUKS/" class="md-nav__link">
        LUKS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../LVM/" class="md-nav__link">
        LVM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../RAID_Rebuild/" class="md-nav__link">
        RAID Rebuild
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../RAID_Resize/" class="md-nav__link">
        RAID Resize
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ZFS/" class="md-nav__link">
        ZFS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sfdisk_usage/" class="md-nav__link">
        Sfdisk usage
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
      
      <label class="md-nav__link" for="nav-6">
        GitLab
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="GitLab" data-md-level="1">
        <label class="md-nav__title" for="nav-6">
          <span class="md-nav__icon md-icon"></span>
          GitLab
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../GitLab/registry_clean/" class="md-nav__link">
        Registry Management
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
      
      <label class="md-nav__link" for="nav-7">
        LDAP
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="LDAP" data-md-level="1">
        <label class="md-nav__title" for="nav-7">
          <span class="md-nav__icon md-icon"></span>
          LDAP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../LDAP/LDAP_tunning/" class="md-nav__link">
        LDAP tunning
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../LDAP/Monitoring_LDAP/" class="md-nav__link">
        Monitoring LDAP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../LDAP/Recover_admin_password/" class="md-nav__link">
        Recover admin password lost
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../LDAP/Reset_slave_state/" class="md-nav__link">
        Reset slave state
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
      
      <label class="md-nav__link" for="nav-8">
        Linux
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="nav-8">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Bluetooth/" class="md-nav__link">
        Bluetooth
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Busybox/" class="md-nav__link">
        Busybox
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Copy_sparse_files/" class="md-nav__link">
        Copier un fichier sparse sur le réseau
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Create_floppy_disk/" class="md-nav__link">
        Create floppy disk
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Create_img_disk/" class="md-nav__link">
        Create img disk
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Create_iso_file/" class="md-nav__link">
        Create iso file
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Curl/" class="md-nav__link">
        Curl
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Encrypt_files/" class="md-nav__link">
        Encrypt files
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/GPG/" class="md-nav__link">
        GPG
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Get_file_creation_time/" class="md-nav__link">
        Get file creation time
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Get_process_info/" class="md-nav__link">
        Get process info
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Git/" class="md-nav__link">
        Git
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Grep_regex/" class="md-nav__link">
        Grep
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/MPD/" class="md-nav__link">
        MPD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Memo/" class="md-nav__link">
        Memo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/RSyslog/" class="md-nav__link">
        RSyslog
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Repair_broken_GRUB/" class="md-nav__link">
        Repair broken GRUB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/SELinux/" class="md-nav__link">
        SELinux
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/SSH/" class="md-nav__link">
        SSH
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Sed/" class="md-nav__link">
        Sed
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Set_Kernel_in_Grub/" class="md-nav__link">
        Set Kernel version in Grub
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Tmux/" class="md-nav__link">
        Tmux
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Vim/" class="md-nav__link">
        Vim
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/openSSL/" class="md-nav__link">
        openSSL
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-25" type="checkbox" id="nav-8-25" >
      
      <label class="md-nav__link" for="nav-8-25">
        Cockpit
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Cockpit" data-md-level="2">
        <label class="md-nav__title" for="nav-8-25">
          <span class="md-nav__icon md-icon"></span>
          Cockpit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Cockpit/cockpit/" class="md-nav__link">
        Cockpit
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" >
      
      <label class="md-nav__link" for="nav-9">
        Mail
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Mail" data-md-level="1">
        <label class="md-nav__title" for="nav-9">
          <span class="md-nav__icon md-icon"></span>
          Mail
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Mail/Postfix/" class="md-nav__link">
        Postfix
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Mail/Telnet/" class="md-nav__link">
        Use Telnet to send mail
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" >
      
      <label class="md-nav__link" for="nav-10">
        Network
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Network" data-md-level="1">
        <label class="md-nav__title" for="nav-10">
          <span class="md-nav__icon md-icon"></span>
          Network
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Network/App_jail/" class="md-nav__link">
        App jail
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Network/Carp/" class="md-nav__link">
        CARP (openBSD)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Network/FirewallD/" class="md-nav__link">
        FirewallD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Network/NetworkManager/" class="md-nav__link">
        Start shell script on Network Manager successful connection
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Network/Network_Diag/" class="md-nav__link">
        Network Diag
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Network/TCPdump/" class="md-nav__link">
        TCPdump
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Network/Trafic_error/" class="md-nav__link">
        Trafi error
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" >
      
      <label class="md-nav__link" for="nav-11">
        OS
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="OS" data-md-level="1">
        <label class="md-nav__title" for="nav-11">
          <span class="md-nav__icon md-icon"></span>
          OS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Clonezilla_PXE/" class="md-nav__link">
        Clonezilla PXE
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/openSUSE_memo/" class="md-nav__link">
        openSUSE memo
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11-3" type="checkbox" id="nav-11-3" >
      
      <label class="md-nav__link" for="nav-11-3">
        CentOS
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="CentOS" data-md-level="2">
        <label class="md-nav__title" for="nav-11-3">
          <span class="md-nav__icon md-icon"></span>
          CentOS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/CentOS/Apache_SeLinux/" class="md-nav__link">
        Apache SeLinux
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/CentOS/Colorful_root_prompt/" class="md-nav__link">
        Colorized prompt for root
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/CentOS/vimrc/" class="md-nav__link">
        Vimrc
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11-4" type="checkbox" id="nav-11-4" >
      
      <label class="md-nav__link" for="nav-11-4">
        Centreon
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Centreon" data-md-level="2">
        <label class="md-nav__title" for="nav-11-4">
          <span class="md-nav__icon md-icon"></span>
          Centreon
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Centreon/SNMP_Config/" class="md-nav__link">
        Centreon
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11-5" type="checkbox" id="nav-11-5" >
      
      <label class="md-nav__link" for="nav-11-5">
        Debian
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Debian" data-md-level="2">
        <label class="md-nav__title" for="nav-11-5">
          <span class="md-nav__icon md-icon"></span>
          Debian
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Debian/Custom_image/" class="md-nav__link">
        Custom image
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Debian/Tricks/" class="md-nav__link">
        Tricks
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Debian/apt_conf/" class="md-nav__link">
        Configuration APT
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11-6" type="checkbox" id="nav-11-6" >
      
      <label class="md-nav__link" for="nav-11-6">
        Fedora
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Fedora" data-md-level="2">
        <label class="md-nav__title" for="nav-11-6">
          <span class="md-nav__icon md-icon"></span>
          Fedora
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Fedora/Manage_repositories/" class="md-nav__link">
        Manage repositories
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12" >
      
      <label class="md-nav__link" for="nav-12">
        PAM SSSD
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="PAM SSSD" data-md-level="1">
        <label class="md-nav__title" for="nav-12">
          <span class="md-nav__icon md-icon"></span>
          PAM SSSD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../PAM_SSSD/Disable_fprintd/" class="md-nav__link">
        Disable fprintd
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../PAM_SSSD/polkit/" class="md-nav__link">
        Autoriser Polkit Pam avec SSSD
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13" >
      
      <label class="md-nav__link" for="nav-13">
        Podman
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Podman" data-md-level="1">
        <label class="md-nav__title" for="nav-13">
          <span class="md-nav__icon md-icon"></span>
          Podman
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Podman/Pods/" class="md-nav__link">
        Create pods with Podman
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Podman/Tips/" class="md-nav__link">
        Tips and tricks about Podman
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14" >
      
      <label class="md-nav__link" for="nav-14">
        SQL
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="SQL" data-md-level="1">
        <label class="md-nav__title" for="nav-14">
          <span class="md-nav__icon md-icon"></span>
          SQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL/MySQL/" class="md-nav__link">
        MySQL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL/PostgreSQL/" class="md-nav__link">
        PostgreSQL
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15" >
      
      <label class="md-nav__link" for="nav-15">
        Systemd
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Systemd" data-md-level="1">
        <label class="md-nav__title" for="nav-15">
          <span class="md-nav__icon md-icon"></span>
          Systemd
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Systemd/Mount_Shares/" class="md-nav__link">
        Mount via Systemd Units
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16" >
      
      <label class="md-nav__link" for="nav-16">
        Virt
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Virt" data-md-level="1">
        <label class="md-nav__title" for="nav-16">
          <span class="md-nav__icon md-icon"></span>
          Virt
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Virt/Libvirt_cert/" class="md-nav__link">
        How to generate and use a cert for Libvirt
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Virt/Qemu_mount_image/" class="md-nav__link">
        Mounting a QEMU Image
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Virt/Sparse_file_copy/" class="md-nav__link">
        Copier un fichier sparse sur le réseau
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Virt/Virt-Manager/" class="md-nav__link">
        Virt Manager
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17" >
      
      <label class="md-nav__link" for="nav-17">
        Web
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Web" data-md-level="1">
        <label class="md-nav__title" for="nav-17">
          <span class="md-nav__icon md-icon"></span>
          Web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Web/Nginx/" class="md-nav__link">
        Nginx
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-17-2" type="checkbox" id="nav-17-2" >
      
      <label class="md-nav__link" for="nav-17-2">
        Apache
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Apache" data-md-level="2">
        <label class="md-nav__title" for="nav-17-2">
          <span class="md-nav__icon md-icon"></span>
          Apache
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Web/Apache/Mapping/" class="md-nav__link">
        Create an redirection mapping
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Web/Apache/Redirection/" class="md-nav__link">
        Redirections Apache
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-17-3" type="checkbox" id="nav-17-3" >
      
      <label class="md-nav__link" for="nav-17-3">
        HAProxy
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="HAProxy" data-md-level="2">
        <label class="md-nav__title" for="nav-17-3">
          <span class="md-nav__icon md-icon"></span>
          HAProxy
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Web/HAProxy/Keepalived_VRRP_Config/" class="md-nav__link">
        Keepalived VRRP Config
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Web/HAProxy/LDAP_configuration/" class="md-nav__link">
        LDAP configuration
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#glusterfs" class="md-nav__link">
    GlusterFS
  </a>
  
    <nav class="md-nav" aria-label="GlusterFS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pour-quoi-faire" class="md-nav__link">
    Pour quoi faire ?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-volumes-glusterfs" class="md-nav__link">
    Les volumes GlusterFS
  </a>
  
    <nav class="md-nav" aria-label="Les volumes GlusterFS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#volume-distribue" class="md-nav__link">
    Volume distribué
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-replique" class="md-nav__link">
    Volume répliqué
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-distribue-replique" class="md-nav__link">
    Volume distribué répliqué
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lenvironnement" class="md-nav__link">
    L’environnement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-trusted-pool" class="md-nav__link">
    Le trusted pool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-volume-replique" class="md-nav__link">
    Un volume répliqué
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connexion-dun-client" class="md-nav__link">
    Connexion d’un client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-brin-de-securite" class="md-nav__link">
    Un brin de sécurité
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#une-corbeille-sur-le-volume" class="md-nav__link">
    Une corbeille sur le volume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-hs-pas-de-panique" class="md-nav__link">
    Node HS ? Pas de panique !
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etendre-le-volume" class="md-nav__link">
    Étendre le volume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-quotas" class="md-nav__link">
    Les quotas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/sebastienpascalpoher/notes/edit/master/docs/Filesystems/GlusterFS.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>GlusterFS</h1>
                
                <p><em><a href="https://www.morot.fr/un-systeme-de-fichiers-haute-disponibilite-avec-glusterfs-paru-dans-glmf-144/">source</a></em></p>
<h2 id="glusterfs">GlusterFS</h2>
<p>GlusterFS  est un système de fichiers réseau client/serveur permettant d’agréger  différents nœuds de stockage afin de fournir un environnement NAS  hautement disponible.</p>
<h3 id="pour-quoi-faire">Pour quoi faire ?</h3>
<p>Admettons que  j’ai une application Web lambda, je vais pouvoir déployer plusieurs  instances Apache ou Nginx qui se trouveront derrière un équilibreur de  charge, lui-même hautement disponible. Sur chaque instance de serveur  Web, il me sera facile de déployer l’application. Toutefois chaque  instance aura besoin d’accéder à des fichiers communs, générés ou non  par l’application. Bien souvent, je vais rencontrer dans ce cas un  serveur NFS qui va donc lui-même constituer un point de faiblesse dans  l’architecture.<br />
Gluster permet de mettre en cluster plusieurs  nœuds de stockage (à minima deux), ce qui permet de répondre à deux  problématiques majeures dès qu’une application a besoin de pouvoir  monter en charge : la parallélisation et la réplication du stockage.  Pour fournir ces fonctionnalités sur un volume, une « brick » en langage  Gluster, le système s’appuie sur des systèmes de fichiers  traditionnels, XFS ou EXT4 au-dessus d’un périphérique en mode bloc  (partition, LVM, RAID, etc..). Gluster travaille donc principalement au  niveau fichier.<br />
Contrairement à un certain nombre d’autres  systèmes de fichiers de ce type, Gluster offre l’immense avantage de ne  pas nécessiter de serveur de méta données pour fonctionner. De fait,  cette absence ne constitue pas un point de faiblesse ou un élément  supplémentaire à maintenir dans l’infrastructure de stockage. De plus,  chaque fois que l’on ajoute un nœud au cluster, le système devient plus  performant et l’augmentation de la performance est linéaire avec  l’extension de l’infrastructure. Dernier point pour mettre en évidence  cette simplicité de conception, il n’existe pas de notion de maître ou  d’esclave avec GlusterFS.</p>
<h3 id="les-volumes-glusterfs">Les volumes GlusterFS</h3>
<p>Un  volume est une agrégation de plusieurs bricks répartis sur différents  nœuds de stockage. Le choix du type de volume se fait en fonction des  attentes de performances, de sécurité ou de la combinaison des deux.  Voyons les types de volumes standards, sachant qu’il existe des modes  géo-répliqués, strippés ou basés sur l’erasure coding pour des workflows  spécifiques.</p>
<h4 id="volume-distribue">Volume distribué</h4>
<p>Ce mode est le mode  par défaut de GlusterFS. Les fichiers sont répartis sur l’ensemble des  bricks du volume sans redondance aucune. Par conséquent, lors de la  perte d’un nœud, les données de celui-ci sont perdues et il faudra se  baser sur des mécanismes complémentaires pour assurer la reprise après  incident. La volumétrie utile est celle de l’ensemble des nœuds du  cluster Ce mode permet une croissance aisée de la volumétrie en ajoutant  simplement des nœuds au volume. Il faut donc au minimum deux nœuds, et  la distribution peut se faire sur autant de nœuds du cluster (voir  figure 1).</p>
<h4 id="volume-replique">Volume répliqué</h4>
<p>Ce  mode permet de répondre au problème de la sécurité de la donnée posé  par le mode distribué. Dans ce mode opératoire, le système maintient n  copies de chaque fichier au sein des « bricks » spécifiées. Il faut donc  autant de nœuds au cluster que de réplicas désirés. De la même façon  que sur du RAID1, la volumétrie utile est la moitié de la volumétrie  allouée (voir figure 2).</p>
<h4 id="volume-distribue-replique">Volume distribué répliqué</h4>
<p>Vous  l’aurez compris, ce mode est une combinaison des deux modes précédents.  Cela permet de traiter des workflows nécessitant disponibilité et  capacité à monter en charge. Le nombre de bricks nécessaires est un  multiple du niveau de réplication attendu. De plus, la réplication entre  les bricks est définie par leur ordre de déclaration à la création du  volume. Pour quatre bricks avec deux réplicas, les deux premières bricks  répliquent ensemble et de même pour les deux suivantes (voir figure 3).  Si nous souhaitions quatre réplicas, il nous faudrait donc huit bricks  et les quatre premières répliqueraient entre elles.</p>
<h3 id="lenvironnement">L’environnement</h3>
<p>GlusterFS  est assez agnostique par rapport à l’environnement et à la  distribution. Pour ma part, les démonstrations suivantes seront toutes  réalisées sous Ubuntu 16.04. Un point indispensable étant que les nœuds  soient capables de discuter par leur nom, qu’il soit résolu par DNS ou  par le fichier hosts, mais pas par adresse IP. Pour la suite, je  partirai sur deux VMs stor0 et stor1 afin de monter un cluster à deux nœuds.<br />
Chaque  serveur dispose d’un second disque virtuel de 10 Gio pour la  démonstration. Le périphérique doit par contre impérativement disposer  d’un système de fichiers supportant les attributs étendus, ext4 ou XFS  sachant qu’XFS est de loin le système de fichiers recommandé. La  convention de nommage veut, mais n’impose pas, que les données soient  placées dans /data/glusterfs/volume/brick. La création des volumes peut se faire simplement comme ceci :</p>
<div class="codehilite"><pre><span></span><code><span class="err">apt-get -y install lvm2 acl attr xfsprogs</span>
<span class="err">$(echo o; echo n; echo p; echo 1; echo ; echo; echo t; echo 8E; echo w) | fdisk /dev/sdb</span>
<span class="err">pvcreate /dev/sdb1</span>
<span class="err">vgcreate VG-Brick0 /dev/sdb1</span>
<span class="err">lvcreate -l 100%VG -n LV-Brick0 VG-Brick0</span>
<span class="err">mkfs.xfs -i size=512 -L Brick0 /dev/VG-Brick0/LV-Brick0</span>
<span class="err">mkdir -p /data/glusterfs/vol0/</span>
<span class="err">echo &quot;/dev/VG-Brick0/LV-Brick0 /data/glusterfs/vol0/ xfs defaults 1 2&quot; &gt;&gt; /etc/fstab</span>
<span class="err">mount /data/glusterfs/vol0/</span>
<span class="err">mkdir /data/glusterfs/vol0/brick0</span>
</code></pre></div>

<p>Le LVM n’est pas obligatoire, mais s’y tenir permet d’avoir les  bons réflexes pour de la production. Pour le reste, l’installation des  packages est très simple, cette simple commande suffit :</p>
<p>apt-get -y install glusterfs-server</p>
<p>Par  souci de simplification, aucun pare-feu n’est activé sur les  différentes machines. Point de vigilance, il ne faudra pas cloner les  machines avec le disque de données supplémentaire.</p>
<h3 id="le-trusted-pool">Le trusted pool</h3>
<p>Avant  d’être en mesure de gérer des volumes de stockage, les membres d’un  cluster GlusterFS doivent se reconnaître entre eux et faire partie d’un  même trusted pool. Tant que cette opération n’est pas réalisée, il n’est  pas possible pour un hôte de joindre le réseau de stockage. Pour cela,  c’est très simple, il suffit depuis un nœud de sonder avec la commande  gluster peer probe d’ajouter les autres nœuds :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor1:~# gluster peer probe stor0</span>
<span class="err">peer probe: success.</span>
</code></pre></div>

<p>Pour vérifier :</p>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">peer</span><span class="w"> </span><span class="n">status</span><span class="w"></span>

<span class="n">Number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">Peers</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="nl">Hostname</span><span class="p">:</span><span class="w"> </span><span class="n">stor0</span><span class="w"></span>
<span class="nl">Uuid</span><span class="p">:</span><span class="w"> </span><span class="n">a920b020</span><span class="o">-</span><span class="mf">9e5</span><span class="n">a</span><span class="o">-</span><span class="mi">46</span><span class="n">f6</span><span class="o">-</span><span class="n">b073</span><span class="o">-</span><span class="mi">1</span><span class="n">cc8ec00ba0e</span><span class="w"></span>
<span class="k">State</span><span class="err">:</span><span class="w"> </span><span class="n">Peer</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="p">(</span><span class="n">Connected</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<h3 id="un-volume-replique">Un volume répliqué</h3>
<p>On  va poursuivre notre itinéraire au sein de GlusterFS en créant un volume  répliqué à deux nœuds. J’ai donné en introduction un exemple basé sur  des attentes de haute disponibilité du stockage, il me semble pertinent  de poursuivre sur cet exemple qui parlera sans doute davantage. Notre  cluster ayant deux nœuds, avec conservation de deux copies, cela nous  fait donc un système en miroir. Sur chaque serveur, on indique le  dossier dans lequel se trouvent les données. Par sécurité, il est  préconisé de créer le volume dans un sous-répertoire du point de montage  afin qu’en cas d’échec de montage du volume, cela n’ait pas d’incidence  sur la réplication gluster. Du fait du risque d’avoir un dossier vide  sur un membre du cluster lors du démarrage des services, le comportement  ne serait pas forcément prévisible.</p>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">vol</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">transport</span><span class="w"> </span><span class="n">tcp</span><span class="w"> </span><span class="nl">stor0</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="o">/</span><span class="w"> </span><span class="nl">stor1</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="o">/</span><span class="w"></span>

<span class="n">volume</span><span class="w"> </span><span class="k">create</span><span class="err">:</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="nl">vol</span><span class="p">:</span><span class="w"> </span><span class="nl">success</span><span class="p">:</span><span class="w"> </span><span class="n">please</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="k">data</span><span class="w"></span>
<span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">vol</span><span class="w"></span>
<span class="n">volume</span><span class="w"> </span><span class="k">start</span><span class="err">:</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="nl">vol</span><span class="p">:</span><span class="w"> </span><span class="n">success</span><span class="w"></span>
</code></pre></div>

<p>On peut donc vérifier que tout  est en ordre avec la commande ci-dessous. Le volume doit être marqué  comme online sur l’ensemble des nœuds :</p>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="n">status</span><span class="w"></span>
<span class="n">Status</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">volume</span><span class="p">:</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">vol</span><span class="w"></span>

<span class="n">Gluster</span><span class="w"> </span><span class="n">process</span><span class="w">                             </span><span class="n">TCP</span><span class="w"> </span><span class="n">Port</span><span class="w">  </span><span class="n">RDMA</span><span class="w"> </span><span class="n">Port</span><span class="w">  </span><span class="n">Online</span><span class="w">  </span><span class="n">Pid</span><span class="w"></span>
<span class="c1">------------------------------------------------------------------------------</span>
<span class="n">Brick</span><span class="w"> </span><span class="nl">stor0</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="w">     </span><span class="mi">49152</span><span class="w">     </span><span class="mi">0</span><span class="w">          </span><span class="n">Y</span><span class="w">       </span><span class="mi">2536</span><span class="w"></span>
<span class="n">Brick</span><span class="w"> </span><span class="nl">stor1</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="w">     </span><span class="mi">49152</span><span class="w">     </span><span class="mi">0</span><span class="w">          </span><span class="n">Y</span><span class="w">       </span><span class="mi">2338</span><span class="w"></span>
<span class="n">NFS</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">localhost</span><span class="w">                     </span><span class="mi">2049</span><span class="w">      </span><span class="mi">0</span><span class="w">          </span><span class="n">Y</span><span class="w">       </span><span class="mi">2359</span><span class="w"></span>
<span class="n">Self</span><span class="o">-</span><span class="n">heal</span><span class="w"> </span><span class="n">Daemon</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">localhost</span><span class="w">               </span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="w">       </span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="w">        </span><span class="n">Y</span><span class="w">       </span><span class="mi">2364</span><span class="w"></span>
<span class="n">NFS</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">stor0</span><span class="w">                         </span><span class="mi">2049</span><span class="w">      </span><span class="mi">0</span><span class="w">          </span><span class="n">Y</span><span class="w">       </span><span class="mi">2557</span><span class="w"></span>
<span class="n">Self</span><span class="o">-</span><span class="n">heal</span><span class="w"> </span><span class="n">Daemon</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">stor0</span><span class="w">                   </span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="w">       </span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="w">        </span><span class="n">Y</span><span class="w">       </span><span class="mi">2562</span><span class="w"></span>
<span class="n">Task</span><span class="w"> </span><span class="n">Status</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">Volume</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">vol</span><span class="w"></span>
<span class="c1">------------------------------------------------------------------------------</span>
<span class="n">There</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="n">tasks</span><span class="w"></span>
</code></pre></div>

<h3 id="connexion-dun-client">Connexion d’un client</h3>
<p>Il existe trois mécanismes d’accès principaux côté client :<br />
–  le client natif accédé au travers de FUSE, le système permettant de  créer des pilotes de filesystem au niveau userland. Il suffit pour cela  d’installer les packages nécessaires.<br />
– via NFS, Gluster  impémentant nativement le support NFS. Si vous avez été vigilant lors de  l’installation du package glusterfs-server, vous avez sûrement remarqué  certaines dépendances. Le serveur NFS n’est pas activé par défaut  cependant.<br />
– en CIFS, avec un serveur Samba.<br />
Dans les deux  derniers cas, il est souhaitable d’associer les serveurs à un système de  type CTDB pour fournir de la haute disponibilité. NFS et Samba ne  savent en effet pas tirer parti de l’ensemble des fonctionnalités  contrairement au client natif. Connectons donc un premier client :</p>
<div class="codehilite"><pre><span></span><code><span class="err">apt-get -y install glusterfs-client</span>
<span class="err">mkdir /data</span>
<span class="err">mount -t glusterfs stor1:/repl-vol /data</span>
</code></pre></div>

<p>Créons un fichier aléatoire avec par exemple la commande ci-dessous.</p>
<div class="codehilite"><pre><span></span><code><span class="err">dd if=/dev/urandom of=/data/toto bs=1024 count=10240</span>
</code></pre></div>

<p>Pour  confirmer que la réplication est fonctionnelle, il suffit de vérifier  avec une simple commande ls que le fichier est présent sur les bricks de  chacun des deux serveurs GlusterFS :</p>
<div class="codehilite"><pre><span></span><code><span class="err">ls -l /data/glusterfs/vol0/brick0/toto</span>
<span class="err">-rw-r--r-- 2 root root 10485760 sept.  9 19:58 /data/glusterfs/vol0/brick0/toto</span>
</code></pre></div>

<p>Un  point qui a dû vous surprendre est la commande de montage. On a en  effet explicitement spécifié l’un des serveurs alors que l’on est censé  avoir déployé un stockage hautement disponible. En pratique, le client  natif glusterfs ne fait que récupérer lors de la commande de mount les  informations de configuration du cluster. Il communiquera directement  avec l’ensemble des serveurs définis dans les volfile (dans le  répertoire /var/lib/glusterd/vols/repl-vol sur les  nœuds de stockage). Un bon moyen de vérifier est d’arrêter  le nœud vers  lequel on a réalisé le montage (un halt -p sur stor1 dans ce cas) : le  client doit continuer à fonctionner. Côté client, la perte de connexion  doit être visible dans le fichier /var/log/glusterfs/data.log</p>
<div class="codehilite"><pre><span></span><code><span class="err">[2017-09-09 18:01:18.933835] W [socket.c:588:__socket_rwv] 0-glusterfs: readv on 192.168.69.61:24007 failed (Aucune donnée disponible)</span>
<span class="err">[2017-09-09 18:01:37.954070] W [socket.c:588:__socket_rwv] 0-repl-vol-client-1: readv on 192.168.69.61:49152 failed (Connexion terminée par expiration du délai d&#39;attente)</span>
</code></pre></div>

<p>Un  point que vous aurez noté également, c’est que la bascule n’est pas  immédiate. En pratique, le délai est de 42 secondes. Pour ramener ce  délai à une valeur plus raisonnable de 5 secondes, modifions notre nœud  comme suit :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor1:~# gluster volume set repl-vol network.ping-timeout 5</span>
<span class="err">volume set: success</span>
</code></pre></div>

<p>Ce changement est tracé dans le log /var/log/glusterfs/glustershd.log avec une ligne par nœud comme celle-ci :</p>
<div class="codehilite"><pre><span></span><code><span class="err">[2017-09-09 18:33:19.591108] I [rpc-clnt.c:1823:rpc_clnt_reconfig] 0-repl-vol-client-0: changing ping timeout to 5 (from 42)</span>
</code></pre></div>

<h3 id="un-brin-de-securite">Un brin de sécurité</h3>
<p>Jusqu’ici,  on a pu monter le volume simplement en contactant l’un des serveurs du  pool GlusterFS, mais aucune sécurité supplémentaire n’a été imposée. Il  est possible de restreindre l’accès à notre volume en définissant une  ACL similaire à ce qui existe en NFS via le fichier /etc/exports.</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor2:~# gluster volume set repl-vol auth.allow 192.168.69.104</span>
<span class="err">volume set: success</span>
</code></pre></div>

<p>Il est également possible de définir une  wildcard, par exemple 192.168.69.<em> afin d’autoriser tout un réseau. Dans  cet exemple, nous avons autorisé explicitement une adresse IP à se  connecter au volume.<br />
Nous aurions également pu autoriser un nom  d’hôte ou plusieurs adresses IP ou noms séparés par des virgules. Le  fait de définir l’attribut auth.allow a comme effet immédiat d’interdire  toutes les autres machines qui n’ont pas été explicitement autorisées.  Pour revenir au comportement par défaut, il faut autoriser le caractère  wildcard (</em>) tout simplement. A l’inverse, l’attribut auth.reject  n’interdit aucune machine par défaut (auth.reject avec comme valeur  NONE). Il sert comme vous l’avez deviné à interdire explicitement une  machine. Pour résumer, le contrôle d’accès a une logique similaire avec  ce qui existe côté TCP Wrappers.</p>
<h3 id="une-corbeille-sur-le-volume">Une corbeille sur le volume</h3>
<p>GlusterFS  sait gérer une corbeille au niveau volume pour conserver les fichiers  supprimés. Le dossier est créé automatiquement par gluster et ne peut  être supprimé. Fait intéressant, gluster sait si on le lui dit, tirer  parti de cette corbeille pour ses opérations internes. Activons donc une  corbeille pour les fichiers de moins de 10 Mio :</p>
<div class="codehilite"><pre><span></span><code><span class="err">gluster volume set repl-vol features.trash on</span>
<span class="err">gluster volume set repl-vol features.trash-dir &quot;Corbeille&quot;</span>
<span class="err">gluster volume set repl-vol features.trash-max-filesize 10485760</span>
<span class="err">gluster volume set repl-vol features.trash-internal-op on</span>
</code></pre></div>

<h3 id="node-hs-pas-de-panique">Node HS ? Pas de panique !</h3>
<p>Un  incident majeur sur un équipement sensible d’un système d’information,  c’est bien entendu quelque chose auquel on se doit d’être préparé. Dans  un système hautement disponible, tout élément qui n’est pas considéré  comme un point unique de défaillance (SPOF) doit pouvoir être  indisponible sans impacter fortement le bon fonctionnement du système.  Nous nous retrouvons dans un état de fonctionnement dégradé. Si le  système défaillant ne peut être dépanné, un processus de reconstruction  doit être mis en œuvre.<br />
Nous allons considérer que le nœud stor0  est irrémédiablement défaillant, la VM est même supprimée. Cela se  vérifie par la commande suivante :</p>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="n">heal</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">vol</span><span class="w"> </span><span class="n">info</span><span class="w"></span>

<span class="n">Brick</span><span class="w"> </span><span class="nl">stor0</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="w"></span>
<span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="n">Noeud</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">transport</span><span class="w"> </span><span class="n">n</span><span class="err">&#39;</span><span class="n">est</span><span class="w"> </span><span class="n">pas</span><span class="w"> </span><span class="n">connecté</span><span class="w"></span>
<span class="n">Brick</span><span class="w"> </span><span class="nl">stor1</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="w"></span>
<span class="n">Number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">entries</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
</code></pre></div>

<p>Voyons étape par étape comment le nouveau  serveur nommé stor2 va prendre de relais de celui-ci. Pour cela, la  première étape que je ne vais pas détailler consiste à provisionner un  nouveau serveur avec le disque de données et les dépendances comme  indiqué précédemment.<br />
Premièrement, on ajoute le nouveau nœud et  on va confirmer qu’on a bien un nouveau nœud présent, et un ancien  toujours connu du cluster mais manquant :</p>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">peer</span><span class="w"> </span><span class="n">probe</span><span class="w"> </span><span class="n">stor2</span><span class="w"></span>
<span class="n">peer</span><span class="w"> </span><span class="nl">probe</span><span class="p">:</span><span class="w"> </span><span class="n">success</span><span class="p">.</span><span class="w"></span>
<span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">peer</span><span class="w"> </span><span class="n">status</span><span class="w"></span>
<span class="n">Number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">Peers</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="nl">Hostname</span><span class="p">:</span><span class="w"> </span><span class="n">stor0</span><span class="w"></span>
<span class="nl">Uuid</span><span class="p">:</span><span class="w"> </span><span class="n">a920b020</span><span class="o">-</span><span class="mf">9e5</span><span class="n">a</span><span class="o">-</span><span class="mi">46</span><span class="n">f6</span><span class="o">-</span><span class="n">b073</span><span class="o">-</span><span class="mi">1</span><span class="n">cc8ec00ba0e</span><span class="w"></span>
<span class="k">State</span><span class="err">:</span><span class="w"> </span><span class="n">Peer</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="p">(</span><span class="n">Disconnected</span><span class="p">)</span><span class="w"></span>

<span class="nl">Hostname</span><span class="p">:</span><span class="w"> </span><span class="n">stor2</span><span class="w"></span>
<span class="nl">Uuid</span><span class="p">:</span><span class="w"> </span><span class="n">f2a03465</span><span class="o">-</span><span class="mi">11</span><span class="n">bb</span><span class="o">-</span><span class="mi">4</span><span class="n">c2a</span><span class="o">-</span><span class="n">a882</span><span class="o">-</span><span class="mi">22933</span><span class="n">cfa2d08</span><span class="w"></span>
<span class="k">State</span><span class="err">:</span><span class="w"> </span><span class="n">Peer</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="p">(</span><span class="n">Connected</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>Remplaçons maintenant la brick du stor0 par celle de notre nouveau serveur stor2 et vérifions son état de santé :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor1:~# gluster volume replace-brick repl-vol stor0:/data/glusterfs/vol0/brick0 stor2:/data/glusterfs/vol0/brick0 commit force</span>
<span class="err">volume replace-brick: success: replace-brick commit force operation successful</span>
</code></pre></div>

<p>On réconcilie le volume :</p>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="n">heal</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">vol</span><span class="w"> </span><span class="k">full</span><span class="w"></span>

<span class="n">Launching</span><span class="w"> </span><span class="n">heal</span><span class="w"> </span><span class="k">operation</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="n">self</span><span class="w"> </span><span class="n">heal</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">vol</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">successful</span><span class="w"></span>
<span class="k">Use</span><span class="w"> </span><span class="n">heal</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="n">status</span><span class="w"></span>
<span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="n">heal</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">vol</span><span class="w"> </span><span class="n">info</span><span class="w"></span>
<span class="n">Brick</span><span class="w"> </span><span class="nl">stor2</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="w"></span>
<span class="n">Number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">entries</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="n">Brick</span><span class="w"> </span><span class="nl">stor1</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="w"></span>
<span class="n">Number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">entries</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
</code></pre></div>

<p>Et depuis le nouveau node, lançons une synchronisation :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor2:/data/glusterfs/vol0/brick0# gluster volume sync stor1 repl-vol</span>
<span class="err">Sync volume may make data inaccessible while the sync is in progress. Do you want to continue? (y/n) y</span>
</code></pre></div>

<p>Il  nous reste une dernière étape : répliquer le volume id dans les  attributs étendus du système de fichiers et le propager au second  serveur. Pour le récupérer, il faut lancer la commande suivante :</p>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">getfattr</span><span class="w">  </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="n">trusted</span><span class="p">.</span><span class="n">glusterfs</span><span class="p">.</span><span class="n">volume</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="o">/</span><span class="w"></span>
<span class="nl">getfattr</span><span class="p">:</span><span class="w"> </span><span class="n">Suppression</span><span class="w"> </span><span class="n">des</span><span class="w"> </span><span class="err">«</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">»</span><span class="w"> </span><span class="n">en</span><span class="w"> </span><span class="n">tête</span><span class="w"> </span><span class="n">des</span><span class="w"> </span><span class="n">chemins</span><span class="w"> </span><span class="n">absolus</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="k">file</span><span class="err">:</span><span class="w"> </span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="o">/</span><span class="w"> </span><span class="n">trusted</span><span class="p">.</span><span class="n">glusterfs</span><span class="p">.</span><span class="n">volume</span><span class="o">-</span><span class="n">id</span><span class="o">=</span><span class="mi">0</span><span class="n">seEhN1zXZTFOXmRGV92ibvw</span><span class="o">==</span><span class="w"></span>
</code></pre></div>

<p>Sur le nouveau serveur, on applique l’ID du volume sur la brick :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor2:/data/glusterfs/vol0/brick0# setfattr -n trusted.glusterfs.volume-id -v &#39;0seEhN1zXZTFOXmRGV92ibvw==&#39; /data/glusterfs/vol0/brick0/</span>
<span class="err">service glusterfs-server restart</span>
</code></pre></div>

<p>La configuration de notre  volume est bien mise à jour comme on peut le voir ci-dessous. Dans le  cadre d’un volume distribué, il faudrait lancer un rééquilibrage  (rebalance) du volume :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor1:~# gluster volume info repl-vol</span>
<span class="err">Volume Name: repl-vol</span>
<span class="c">Type: Replicate</span>
<span class="err">Volume ID: 1c493043-9c2d-4be6-afcd-8512577342c9</span>
<span class="c">Status: Started</span>
<span class="err">Number of Bricks: 1 x 2 = 2</span>
<span class="c">Transport-type: tcp</span>
<span class="c">Bricks:</span>
<span class="c">Brick1: stor2:/data/glusterfs/vol0/brick0</span>
<span class="c">Brick2: stor1:/data/glusterfs/vol0/brick0</span>
<span class="err">Options Reconfigured:</span>
<span class="err">performance.readdir-ahead: on</span>
<span class="err">cluster.self-heal-daemon: enable</span>
<span class="err">network.ping-timeout: 5</span>
</code></pre></div>

<p>Enfin, il ne reste plus qu’à retirer l’ancien nœud des peers autorisés dans le trusted pool :</p>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">peer</span><span class="w"> </span><span class="n">detach</span><span class="w"> </span><span class="n">stor0</span><span class="w"></span>
<span class="n">peer</span><span class="w"> </span><span class="nl">detach</span><span class="p">:</span><span class="w"> </span><span class="n">success</span><span class="w"></span>

<span class="n">root</span><span class="nv">@stor1</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">peer</span><span class="w"> </span><span class="n">status</span><span class="w"></span>
<span class="n">Number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">Peers</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="nl">Hostname</span><span class="p">:</span><span class="w"> </span><span class="n">stor2</span><span class="w"></span>
<span class="nl">Uuid</span><span class="p">:</span><span class="w"> </span><span class="n">f2a03465</span><span class="o">-</span><span class="mi">11</span><span class="n">bb</span><span class="o">-</span><span class="mi">4</span><span class="n">c2a</span><span class="o">-</span><span class="n">a882</span><span class="o">-</span><span class="mi">22933</span><span class="n">cfa2d08</span><span class="w"></span>
<span class="k">State</span><span class="err">:</span><span class="w"> </span><span class="n">Peer</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="p">(</span><span class="n">Connected</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>Il ne doit plus apparaître dans la liste des nœuds :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor1:~# gluster pool list</span>
<span class="err">UUID                                    Hostname        State</span>
<span class="err">0cb0f3b6-10e5-41c4-ad7e-cb9ca794db9e    stor2           Connected</span>
<span class="err">d5ff9617-6989-48ae-be3a-3e1286060ea1    localhost       Connected</span>
</code></pre></div>

<p>Vous  savez désormais comment remplacer un nœud défaillant, sachant que ce  processus s’applique également en cas de migration de la brick de stor0 vers un nouveau serveur.</p>
<h3 id="etendre-le-volume">Étendre le volume</h3>
<p>Quand  l’espace disque commence à manquer, une première solution peut être  d’étendre l’espace libre sur les bricks, d’où l’intérêt d’être partis au  départ sur du LVM. Une autre solution est d’étendre le cluster avec de  nouveaux nœuds afin d’améliorer la disponibilité du système dans son  ensemble. Cette extension du cluster se fait en outre sans interruption  de service.<br />
Pour étendre un cluster répliqué, il faut ajouter un  nombre de bricks avec un nombre multiple du nombre de réplicas. Nous  avons monté un volume à deux réplicas, il nous faut donc ajouter deux  bricks supplémentaires. La commande gluster volume info repl-vol nous permet de le confirmer (1×2). Nous allons ajouter donc deux serveurs stor3 et stor4, avec le volume disque préparé et le package glusterfs-server installé.<br />
La première étape consiste à autoriser les deux nœuds avec la commande gluster peer probe vue précédemment. On peut donc ensuite ajouter des bricks au volume en spécifiant les bricks de nos deux nouveaux serveurs :</p>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="nv">@stor2</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">gluster</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="k">add</span><span class="o">-</span><span class="n">brick</span><span class="w"> </span><span class="n">repl</span><span class="o">-</span><span class="n">vol</span><span class="w"> </span><span class="nl">stor3</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="w"> </span><span class="nl">stor4</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">glusterfs</span><span class="o">/</span><span class="n">vol0</span><span class="o">/</span><span class="n">brick0</span><span class="w"></span>

<span class="n">volume</span><span class="w"> </span><span class="k">add</span><span class="o">-</span><span class="nl">brick</span><span class="p">:</span><span class="w"> </span><span class="n">success</span><span class="w"></span>
</code></pre></div>

<p>Vérifions notre volume, nous devons retrouver nos deux bricks supplémentaires.</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor2:~# gluster volume info repl-vol</span>
<span class="err">Volume Name: repl-vol</span>
<span class="c">Type: Distributed-Replicate</span>
<span class="err">Volume ID: 78484dd7-35d9-4c53-9799-1195f7689bbf</span>
<span class="c">Status: Started</span>
<span class="err">Number of Bricks: 2 x 2 = 4</span>
<span class="c">Transport-type: tcp</span>
<span class="c">Bricks:</span>
<span class="c">Brick1: stor2:/data/glusterfs/vol0/brick0</span>
<span class="c">Brick2: stor1:/data/glusterfs/vol0/brick0</span>
<span class="c">Brick3: stor3:/data/glusterfs/vol0/brick0</span>
<span class="c">Brick4: stor4:/data/glusterfs/vol0/brick0</span>
<span class="err">Options Reconfigured:</span>
<span class="err">performance.readdir-ahead: on</span>
</code></pre></div>

<p>Notre volume à deux réplicas  comportant quatre nœuds se comporte donc désormais comme un volume  distribué répliqué par la magie de l’extension du volume. Seul problème,  il n’y a aucune donnée sur les serveurs stor3 et stor4,  ce qui n’a pas eu pour effet de libérer de l’espace disque sur les deux  premiers serveurs. Il est donc nécessaire de répartir la volumétrie sur  l’ensemble des bricks qui composent le volume :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor2:~# gluster volume rebalance repl-vol start&lt; volume rebalance: repl-vol: success: Rebalance on repl-vol has been started successfully. Use rebalance status command to check status of the rebalance process. </span>
<span class="c">ID: dffbed2e-3a0c-4d7d-9f43-9d978a546b04</span>
</code></pre></div>

<p>Pour vérifier il suffit de lancer la même commande avec le paramètre status :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor2:~# gluster volume rebalance repl-vol status</span>
<span class="err">Node Rebalanced-files          size       scanned      failures       skipped               status   run time in secs</span>
<span class="err">---------      -----------   -----------   -----------   -----------   -----------         ------------     --------------</span>
<span class="err">localhost                5        0Bytes            10             0             0            completed               2.00</span>
<span class="err">stor1                0        0Bytes             0             0             0            completed               1.00</span>
<span class="err">stor3                0        0Bytes             2             0             0            completed               1.00</span>
<span class="err">stor4                0        0Bytes             0             0             0            completed               1.00</span>
<span class="err">volume rebalance: repl-vol: success</span>
</code></pre></div>

<h3 id="les-quotas">Les quotas</h3>
<p>GlusterFS  dispose d’un mécanisme permettant de définir des quotas au niveau  dossier. Ils ne sont pas activés par défaut. Pour changer ce  comportement :</p>
<p>root@stor2:~# gluster volume quota repl-vol enable<br />
volume quota : success</p>
<p>Nous allons appliquer une limite à 1Gio  sur le sous-dossier subdir de notre volume. Ce dossier devra avoir été  impérativement créé depuis le client glusterfs ajouté précédemment. Pour  créer ce quota :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@stor2:~# gluster volume quota repl-vol limit-usage /subdir 1GB</span>
<span class="err">volume quota : success</span>
</code></pre></div>

<p>Si nous avions souhaité créer un quota au  niveau du volume, il suffit d’indiquer / dans le chemin. Créons un  fichier approchant le quota depuis notre client GlusterFS :</p>
<div class="codehilite"><pre><span></span><code><span class="err">root@desktop:/data/subdir# dd if=/dev/zero of=/data/subdir/toto bs=1024 count=1024000</span>
<span class="err">1024000+0 enregistrements lus</span>
<span class="err">1024000+0 enregistrements écrits</span>
<span class="err">1048576000 bytes (1,0 GB, 1000 MiB) copied, 223,044 s, 4,7 MB/s</span>
</code></pre></div>

<p>Et voyons l’état du quota :</p>
<p>root@stor1:~# gluster volume quota repl-vol list<br />
Path                   Hard-limit  Soft-limit      Used  Available  Soft-limit exceeded? Hard-limit exceeded?</p>
<hr />
<p>/subdir                                    1.0GB     80%(819.2MB) 1000.0MB  24.0MB             Yes                   No</p>
<p>Reprenons  notre commande précédente, en créant un fichier au nom différent, la  création est bien interrompue sur le dépassement de quota hard :</p>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="nv">@desktop</span><span class="err">:</span><span class="o">/</span><span class="k">data</span><span class="err">#</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span><span class="w"> </span><span class="k">of</span><span class="o">=/</span><span class="k">data</span><span class="o">/</span><span class="n">subdir</span><span class="o">/</span><span class="n">tata</span><span class="w"> </span><span class="n">bs</span><span class="o">=</span><span class="mi">1024</span><span class="w"> </span><span class="nf">count</span><span class="o">=</span><span class="mi">1024000</span><span class="w"></span>

<span class="nl">dd</span><span class="p">:</span><span class="w"> </span><span class="n">erreur</span><span class="w"> </span><span class="n">d</span><span class="s1">&#39;écriture de &#39;</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">subdir</span><span class="o">/</span><span class="n">tata</span><span class="s1">&#39;: Débordement du quota d&#39;</span><span class="n">espace</span><span class="w"> </span><span class="n">disque</span><span class="w"></span>
<span class="nl">dd</span><span class="p">:</span><span class="w"> </span><span class="n">fermeture</span><span class="w"> </span><span class="n">du</span><span class="w"> </span><span class="n">fichier</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">sortie</span><span class="w"> </span><span class="s1">&#39;/data/subdir/tata&#39;</span><span class="err">:</span><span class="w"> </span><span class="n">Débordement</span><span class="w"> </span><span class="n">du</span><span class="w"> </span><span class="n">quota</span><span class="w"> </span><span class="n">d</span><span class="err">&#39;</span><span class="n">espace</span><span class="w"> </span><span class="n">disque</span><span class="w"></span>
</code></pre></div>

<p>Il  est difficile d’être exhaustif sur un sujet aussi vaste. J’espère  toutefois avoir aiguisé votre appétit sur GlusterFS et vous avoir donné  l’envie de tester ce qui n’a pas été détaillé ici.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../Filesystems_tricks/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Step 1: Find inode number of any file using following command on terminal.
              </div>
            </div>
          </a>
        
        
          <a href="../LUKS/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                LUKS
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>